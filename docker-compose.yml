services:
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_storage:/qdrant/storage
    environment:
      - QDRANT_HOST=0.0.0.0
    restart: unless-stopped

  retina:
    image: ghcr.io/haileyok/osprey-atproto/retina:main
    ports:
      - "8080:8080"
    restart: unless-stopped

  bloblens:
    build:
      context: .
      dockerfile: Dockerfile
    depends_on:
      - qdrant
      - retina
    command:
      - --retina-host=http://retina:8080
      - --websocket-host=wss://bsky.network
      - --qdrant-host=qdrant
      - --qdrant-port=6334
      - --qdrant-collection=profile_blobs
      - --max-search-time=24h
      - --max-limit=20
      - --seen-threshold=5
      - --max-hamming-distance=31
    restart: unless-stopped

volumes:
  qdrant_storage:
